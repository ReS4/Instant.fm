{% extends "base.html" %}

{% block html-classes %}{% if current_user %}loggedIn{% else %}loggedOut{% end %} {% if handler.owns_playlist(playlist) %}isOwner{% else %}isNotOwner{% end %}{% end %}

{% block bodyId %}p{% end %}

{% block body %}
  <header class="clearfix" id="header">
    <a class="ir" href="/" id="headerLogo">
      <h1>Instant.fm - Share Music Playlists Instantly</h1>
    </a>
    <nav>
      <a id="navNewPlaylist" href="#new">New Playlist</a>
      <a id="navSearch" href="/search" rel="partial search" title="Search">Search</a>
      <a class="mustLogout" id="navLogin" href="#login">Login</a>
      <a class="mustLogout" id="navSignup" href="#signUp">Sign up</a>
      <a class="mustLogin" id="navProfile" href="#profile"> {{ handler.render_user_name() }} </a>
      <a class="mustLogin" id="navLogout" href="#logout">Logout</a>
    </nav>
  </header>
  <div class="clearfix" id="main"> 
       
    <section id="playlistDisplay">
    
      <div id="videoDiv">
        <div id="player">&nbsp;</div>
      </div>
      
      <div id="playlistDiv">
        <ul id="playlist">
          <!-- Loaded via JS -->
        </ul>
      </div>
 
      <div id="playlistToolbar">
        <div class="left">
          <a href="#toggleVideo" class="on" id="toggleVideo"><span>Show Video</span></a>
          <a href="#toggleShuffle" id="toggleShuffle"><span>Shuffle</span></a>
          <a href="#toggleRepeat" id="toggleRepeat"><span>Repeat</span></a>
        </div>
        <div class="right">
          <a href="/search" class="mustOwn" id="addSongs" rel="partial search" title="Add Songs"><span>Add Songs</span></a>
        </div>
      </div>
      
    </section> <!-- end of #playlistDisplay -->
  
    <section id="browserDisplay">
      
      <div id="behind">
        
        <header class="iPhoneHeader black" id="nowPlayingHeader">
          <span class="left"><!-- not used on now playing view --></span>
          <div class="title"><h1>Now Playing</h1></div>
          <a class="right black" href="#open">
            <span class="mustNotOwn">Search</span>
            <span class="mustOwn">Add Songs</span>
          </a>
        </header>
        
        <div id="nowPlayingContainer">
          
          <section id="nowPlaying" class="slide">
            
            <section id="curPlaylist"></section>
            
            <script id="curPlaylistTemplate" type="text/x-jquery-tmpl">
              <header class="clearfix">
                <h2 id="curPlaylistTitle">${title}</h2>
              </header>
            
              <article>
                <span id="curPlaylistDesc">${description}</span>
              </article>
            </script>
            
            <!-- <a href="#TODO" id="curPlaylistAuthor">
              <img alt="Feross Aboukhadijeh" src="/images/profilepic.jpg" />
              <div>Feross Aboukhadijeh</div>
            </a> -->
            
            <section id="playlistActions">
              <a href="#addComment" id="addComment" class="awesome white">
                Add a Comment
              </a>
              <a href="#fbShare" id="fbShare" class="darkblue awesome">
                Share on Facebook
              </a>
              <a href="#twShare" id="twShare" class="blue awesome">
                Share on Twitter
              </a>
            </section> <!-- end of #playlistActions -->

            <!-- Facebook comments are loaded with JS here -->

            <section id="curPlaying">
              <header>
                <h3>Currently Playing</h3>
              </header>
              
              <div class="clearfix" id="curAlbumBlock"></div>
              <script id="curAlbumBlockTemplate" type="text/x-jquery-tmpl">
                <a id="curAlbumImg" class="reflect" href="#" title="${albumTitle}">
                  <img alt="${albumAlt}" src="${albumImg}">
                  <span class="zoomIcon"></span>
                </a>
                <div id="curAlbumInfo">
                
                  <div id="curSong">
                    <h4>${trackName}</h4>
                  </div>
                  
                  {{'{{'}}if artistName && artistHref}}
                    <div id="curArtist">
                      <span class="curLabel">by</span> 
                      <h4><a href="${artistHref}" title="${artistName}" rel="partial artist">${artistName}</a></h4>
                    </div>
                  {{'{{'}}/if}}
                  <div id="curAlbum" style="display:none;">
                    <span class="curLabel">on</span> 
                    <h4></h4>
                  </div>
                  
                  <div id="curButtons" style="display:none;">
                    <fb:like href="${songHref}" show_faces="true" width="340"></fb:like>
                  </div>
                  
                </div>
              </script>
              <div id="curDescs">
                <section id="curSongDesc"></section>
                <script id="curSongDescTemplate" type="text/x-jquery-tmpl">
                  <h4>${trackName}</h4> 
                  <article>${trackDescription}</article>
                </script>
                
                <section class="artistDesc" id="curArtistDesc"></section>
                <script id="curArtistDescTemplate" type="text/x-jquery-tmpl">
                  <h4>${artistName}</h4>
                  <a id="curArtistImg" class="artistImg reflect" href="#" title="${artistName}">
                    <img alt="${artistName}" src="${artistImg}">
                    <span class="zoomIcon"></span>
                  </a>
                  <article>${artistDescription}</article>
                </script>
              </div> <!-- end of #curDescs -->

            </section> <!-- end of #curPlaying -->

          </section> <!-- end of #nowPlaying -->
              
        </div> <!-- end of #nowPlayingContainer -->
        
      </div> <!-- end of #behind -->
      
      <div class="animate" id="modal">
        
        <header class="iPhoneHeader blue" id="browserHeader">
          <span class="left"><!-- dynamic back button --></span>
          <div class="title"><!-- dynamic title --></div>
          <a class="right black" href="#close">Now Playing</a>
        </header>
        
        <div id="browser">
          <div id="FS_slider">
            <div id="FS_holder">
              {% block mini-browser %}
              {% end %}
            </div> <!-- end of #FS_holder -->
          </div> <!-- end of #FS_slider -->
        </div> <!-- end of #browser -->
        
      </div> <!-- end of #modal -->
     
    </section> <!-- end of #browserDisplay -->

  </div> <!-- end of #main -->
  
  <footer id="footer">
    <a href="#">Instant.fm</a>
    <a href="#">FAQ</a>
    <a href="#">Blog</a>
    <a href="#">Contact</a>
    <a href="#helpBox" id="helpLink">Keyboard shortcuts available</a>
  </footer>

  <div class="invisible" id="devNull">
    <div id="curAlbumImgZoom">&nbsp;</div>
    <div id="curArtistImgZoom">&nbsp;</div>
  
    <div id="helpBox">
      <div class="fancyZoomHeader">Keyboard shortcuts</div>
      
      <section class="helpSection">
        <div class="fancyZoomSectionHeader">Playback Control</div>
        <dl class="clearfix shortcut">
          <dt class="key">space</dt>
          <dd class="action">Play/pause</dd>
        </dl>
        <dl class="clearfix shortcut">
          <dt class="key">&larr;</dt>
          <dt class="key">&rarr;</dt>
          <dd class="action">Previous/next song</dd>
        </dl>
        <dl class="clearfix shortcut">
          <dt class="key">+</dt>
          <dt class="key">-</dt>
          <dd class="action">Increase/decrease volume</dd>
        </dl>
        <dl class="clearfix shortcut">
          <dt class="key">S</dt>
          <dd class="action">Toggle shuffle</dd>
        </dl>
        <dl class="clearfix shortcut">
          <dt class="key">R</dt>
          <dd class="action">Toggle repeat song</dd>
        </dl>
        <dl class="clearfix shortcut">
          <dt class="key">V</dt>
          <dd class="action">Toggle video display</dd>
        </dl>
      </section>
      <section class="helpSection">
        <div class="fancyZoomSectionHeader">Playlist Editing</div>
        <dl class="clearfix shortcut">
          <dt class="key">K</dt>
          <dd class="action">Move current song up</dd>
        </dl>
        <dl class="clearfix shortcut">
          <dt class="key">J</dt>
          <dd class="action">Move current song down</dd>
        </dl>
      </section>
      <section class="helpSection">
        <div class="fancyZoomSectionHeader">Navigation</div>
        <dl class="clearfix shortcut">
          <dt class="key">F</dt>
          <dd class="action">Search for songs</dd>
        </dl>
        <dl class="clearfix shortcut">
          <dt class="key">L</dt>
          <dd class="action">Go to Current Song</dd>
        </dl>
        <dl class="clearfix shortcut">
          <dt class="key">ESC</dt>
          <dd class="action">Go back one page</dd>
        </dl>
        <dl class="clearfix shortcut">
          <dt class="key">?</dt>
          <dd class="action">Bring up this help dialog</dd>
        </dl>
      </section>
    </div> <!-- end of #helpBox -->
    
    <div id="loginBox">
      <form id="login">
        <div class="fancyZoomSectionHeader"> Login to Instant.fm </div>
        <div id="loginErrors"></div>
        <div class="formRow">
          <label> Email Address: </label>
          <input type="email" name="email" required="required"/>
        </div>
        <div class="formRow">
          <label> Password: </label>
          <input type="password" name="password" required="required"/>
        </div>
        <div class="formRow">
          <input type="checkbox" name="passwordless" checked="checked" />
          <label> Let me login without a password on this browser </label>
        </div>
        {{ xsrf_form_html() }}
        <a class="small grey awesome" onclick="$('form#login').submit();"> Login </a>
      </form>
    </div>
     
    <div id="registrationBox">
      <div class="fancyZoomHeader">Log In or Sign Up</div>
      <div class="loginForm">
        <div class="fancyZoomSectionHeader"> Create an Account </div>
        <a id="fbConnectButton" class="small darkblue awesome"> Connect your Facebook Account </a>
        <div id="fbAccountCreation" style="display:none;">
          <form id="fbRegistration" method="post">
            <div class="loginForm">
              <div id="alreadyRegistered">
                This Facebook user is already registered on Instant.fm. Try logging in instead.
              </div>
              <div id="registrationErrors"></div>
              <div class="formRow">
                <label for="fbName"> Display Name: </label>
                <input id="fbName" type="text" name="name" value="" maxlength="32" required="required"/>
              </div>         
              <div class="formRow">
                <label for="fbEmail"> E-mail: </label>
                <input id="fbEmail" type="email" name="email" required="required"/>
              </div>          
              <div class="formRow">
                <label for="fbPassword"> Password: </label>
                <input id="fbPassword" type="password" name="password" pattern=".{4}" title="Passwords must be at least 4 characters" required="required"/>
              </div>          
            </div>
            <div>
              <img id="fbProfileImage"></img>
            </div>
            <input type="hidden" name="auth_token"></input>
            <input type="hidden" name="fb_user_id"></input>
            {{ xsrf_form_html() }}
            <a id="submitFbRegistration" class="small grey awesome" onclick="$('form#fbRegistration').submit();">Finish</a>
          </div>
       </form>
      </div>
    </div>
          
  </div> <!-- end of #devNull -->
{% end %}

{% block scripts %}
  {% block scripts-partial %}{% end %}
  <script>
    var initial_playlist = {{ json.dumps(playlist).replace('<', '\u003c').replace('>', '\u003e') if playlist else 'null' }};
      $(function() {
          onloadPlaylist();
      });
  </script>
{% end %}